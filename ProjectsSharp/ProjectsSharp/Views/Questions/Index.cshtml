@model ProjectsSharp.Models.Question

<h1>Question</h1>

    @if (Model == null)
    {
        <h2>Fin du questionnaire</h2>
        <div>
            <button onclick="resetQuestions();">Recommencer</button>
        </div>
    }
    else
    {
    <div>
        <h2>@Model.Text</h2>
        <ul>
            @foreach (var option in Model.Options)
            {
                <li>
                    <button data-id="@Model.Id-@option.Replace(" ", "")" onclick="submitOption('@Model.Id', '@option.Replace(" ", "")')">@option</button>
                </li>
            }
        </ul>
    </div>
    <div>
        <button onclick="window.location.reload();">Suivant</button>
    </div>
    }


@Html.AntiForgeryToken()

<!--<script src="js/questions.js"></script>-->
<script>
    function submitOption(questionId, selectedOption) {
        fetch('/Questions/SubmitOption', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: JSON.stringify({ questionId: questionId, selectedOption: selectedOption })
        })
            .then(response => response.json())
            .then(data => {
                document.querySelector(`button[data-id="${questionId}-${selectedOption}"]`).classList.add(data.correct);
            })
            .catch(error => {
                console.error('Erreur:', error);
            });
    }

    function resetQuestions() {
        fetch('/Questions/ResetQuestions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
        .then(response => {
            if (response.ok) {
                window.location.reload();
            } 
        })
        .catch(error => {
             console.error('Erreur:', error);
        });
    }
</script>
